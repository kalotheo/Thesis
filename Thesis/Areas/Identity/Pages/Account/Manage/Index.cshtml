@page
@model IndexModel
@{
    ViewData["Title"] = "Profile";
    ViewData["ActivePage"] = ManageNavPages.Manage;
    string expertProfileVisible = Model.Expert != null ? "d-block" : "d-none";
}

<div class="page-manage-content">
    <h1 class="page_title">@ViewData["Title"]</h1>
    <partial name="_StatusMessage" model="Model.StatusMessage" />

    @if (Model.Expert == null)
    {
        <button class="link expert-profile-btn" onclick="showExpertProfile();">
            <i class="icon fas fa-plus"></i>
            <span id="expert-profile-txt">Register as expert</span>
        </button>
    }
    else
    {
        <button class="link expert-profile-btn" data-toggle="modal" data-target="#deleteModal" onclick="setDeleteValues('Delete Expert Profile', 'Are you sure you want to delete your expert profile? All listings and made offers will be deleted.');">
            <i class="icon fas fa-times"></i>
            <span>Delete expert profile</span>
        </button>
        <a asp-page="/Experts/View" asp-route-id="@Model.Expert.User.UserName" class="ml-3 offer_action offer_action--vendor link">
            <i class="icon fas fa-eye"></i>
            <span>View Profile</span>
        </a>
    }

    <form id="profile-form" method="post" enctype="multipart/form-data">
        <div asp-validation-summary="All" class="text-danger"></div>

        <div class="form-group">
            <label asp-for="FileUpload.Files" class="field_label form_label"></label>
            <div class="input-images-3"></div>
        </div>
        <div class="form-group">
            <label>Username</label>
            <input asp-for="UserManager.UserName" class="form-control" required />
            <span asp-validation-for="UserManager.UserName" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="UserManager.FirstName"></label>
            <input asp-for="UserManager.FirstName" class="form-control" />
            <span asp-validation-for="UserManager.FirstName" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="UserManager.LastName"></label>
            <input asp-for="UserManager.LastName" class="form-control" />
            <span asp-validation-for="UserManager.LastName" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="UserManager.Email"></label>
            <input asp-for="UserManager.Email" type="email" id="manage-email" class="form-control" required />
            <span asp-validation-for="UserManager.Email" class="text-danger"></span>
            @*
                @if (!Model.IsEmailConfirmed)
                {
                    <button id="email-verification" type="submit" asp-page-handler="SendVerificationEmail" class="button-link manage-link">Send verification email</button>
                }
            *@
        </div>
        <div class="form-group">
            <label>Phone Number</label>
            <input asp-for="UserManager.PhoneNumber" class="form-control" />
            <span asp-validation-for="UserManager.PhoneNumber" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Input.OldPassword"></label>
            <input asp-for="Input.OldPassword" id="old-password" class="form-control" />
            <span asp-validation-for="Input.OldPassword" class="text-danger"></span>
        </div>
        <div id="new-password-inputs">
            <div class="form-group">
                <label asp-for="Input.NewPassword"></label>
                <input asp-for="Input.NewPassword" id="new-password" class="form-control" />
                <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Input.ConfirmPassword"></label>
                <input asp-for="Input.ConfirmPassword" id="confirm-password" class="form-control" />
                <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
            </div>
        </div>
        <div id="expert-profile" class="@expertProfileVisible">
            <input type="hidden" asp-for="Expert.Id" value="@Model.UserManager.Id" />
            <div class="form-group">
                <label asp-for="Expert.HourlyRate"></label>
                <input asp-for="Expert.HourlyRate" class="form-control" type="number" min="1" />
                <span asp-validation-for="Expert.HourlyRate" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Expert.Availability"></label>
                <select asp-for="Expert.Availability" class="form-control" asp-items="@Model.ExpertAvailability">
                </select>
                <span asp-validation-for="Expert.Availability" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Expert.Experience"></label>
                <select asp-for="Expert.Experience" class="form-control" asp-items="@Model.ExpertExperience">
                </select>
                <span asp-validation-for="Expert.Experience" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Expert.ProfileInfo"></label>
                <textarea asp-for="Expert.ProfileInfo" class="form-control textarea-min-height"></textarea>
                <span asp-validation-for="Expert.ProfileInfo" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Expert.Tags"></label>
                <input id="multidatalist" list="tags-list" asp-for="Expert.Tags" class="form-control" multiple />
                <datalist id="tags-list">
                    @foreach (var item in Model.TagsList)
                    {
                        <option value="@item">@item</option>
                    }
                </datalist>
                <span asp-validation-for="Expert.Tags" class="text-danger"></span>
            </div>
        </div>
        <button id="update-profile-button" type="submit" class="btn btn-primary">Save changes</button>
    </form>
</div>

<script>
    let preloaded = [];
</script>

@if (Model.UserManager.ProfilePicture != null)
{
    <script>
            preloaded = [
                { id: 1, src: '/uploadfiles/profiles/@Model.UserManager.ProfilePicture' }
            ];
    </script>
}

<partial name="_DeleteModal" />

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
